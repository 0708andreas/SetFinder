<!doctype html>
<html>
    <head>
        <meta charset="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Hello OpenCV.js</title>
    </head>
    <body>
        <h2>SetFinder</h2>
        <p id="status">OpenCV.js is loading...</p>
        <div>
            <div class="inputoutput">
                <img
                    id="imageSrc"
                    height="75%"
                    alt="No Image"
                    style="visibility: hidden; position: absolute"
                />
                <div class="caption">
                    <!-- imageSrc -->
                    <input
                        type="file"
                        id="fileInput"
                        name="file"
                        accept="image/*"
                    />
                    <br />
                    How many cards on the table:
                    <input
                        type="number"
                        id="numCardsInput"
                        value="12"
                        min="3"
                        step="3"
                    />
                </div>
            </div>
            <div class="inputoutput">
                <canvas id="canvasOutput" width="50%"></canvas>
                <!-- <div class="caption">canvasOutput</div> -->
            </div>
        </div>
        <script async src="opencv.js" type="text/javascript"></script>
        <script src="set.js" type="text/javascript"></script>
        <script type="text/javascript">
            let imgElement = document.getElementById("imageSrc");
            let inputElement = document.getElementById("fileInput");
            inputElement.addEventListener(
                "change",
                (e) => {
                    imgElement.src = URL.createObjectURL(e.target.files[0]);
                },
                false,
            );
            imgElement.onload = do_cv_magic;
            // imgElement.onload = function () {
            //     let mat = cv.imread(imgElement);
            //     cv.imshow("canvasOutput", mat);
            //     mat.delete();
            // };

            var Module = {
                // https://emscripten.org/docs/api_reference/module.html#Module.onRuntimeInitialized
                onRuntimeInitialized() {
                    document.getElementById("status").innerHTML =
                        "OpenCV.js is ready.";
                },
            };
        </script>
    </body>
</html>
